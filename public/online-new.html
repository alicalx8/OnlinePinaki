<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinaki Online</title>
    <link rel="stylesheet" href="style.css?v=3">
    <style>
        .lobby-container {
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: rgba(0,0,0,0.8);
            border-radius: 10px;
            color: white;
        }
        .room-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        .join-btn {
            width: 100%;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px 0;
        }
        .join-btn:hover {
            background: #45a049;
        }
        .players-list {
            margin: 20px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
        .start-game-btn {
            width: 100%;
            padding: 15px;
            background: #ffd700;
            color: #222;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px 0;
            font-weight: bold;
        }
        .start-game-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        /* Navbar */
        .navbar {
            position: fixed;
            inset: 0 auto auto 0;
            width: 100%;
            z-index: 1002;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            background: rgba(0,0,0,0.95);
            border-bottom: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 2px 10px rgba(0,0,0,0.35);
        }
        .nav-left, .nav-right { display: flex; align-items: center; gap: 10px; }
        .nav-right { justify-content: flex-end; justify-self: end; }
        .nav-center { text-align: center; font-weight: 800; font-size: 18px; letter-spacing: .3px; }
        .navbar button {
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            background: #ffd700;
            color: #222;
            font-weight: 700;
            cursor: pointer;
        }
        .dropdown { position: relative; }
        .dropdown > summary {
            list-style: none;
            cursor: pointer;
            padding: 8px 10px;
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
        }
        .dropdown > summary::-webkit-details-marker { display: none; }
        .dropdown[open] > summary { background: rgba(255,255,255,0.15); }
        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            min-width: 280px;
            background: rgba(20,20,20,0.98);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }
        .dropdown-menu h3 { margin: 0 0 8px 0; font-size: 16px; }
        .dropdown-menu p, .dropdown-menu li { font-size: 14px; line-height: 1.35; }
    </style>
</head>
<body>
        <div class="lobby-container">
        
        <div id="join-section">
            <h2>Odaya Katıl</h2>
            <input type="text" id="room-id" class="room-input" placeholder="Oda ID" value="test-room">
            <input type="text" id="player-name" class="room-input" placeholder="Oyuncu Adı" value="Oyuncu">
            <div style="display: flex; gap: 10px; margin: 10px 0;">
                <button id="join-btn" class="join-btn" type="button">Oyuncu Olarak Katıl</button>
                <button id="spectator-btn" style="flex: 1; padding: 15px; background: #6c5ce7; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer;">Misafir Olarak İzle</button>
            </div>
            <button id="bots-vs-btn" class="start-game-btn" type="button" style="background:#2ecc71;color:#111;">Botlara Karşı Oyna</button>
            <button id="debug-btn" style="margin-top: 10px; padding: 10px; background: #ff6b6b; color: white; border: none; border-radius: 5px; cursor: pointer;">Bağlantıyı Test Et</button>
        </div>

        <div id="lobby-section" style="display:none;">
            <h2>Oda: <span id="room-display"></span></h2>
            <div class="players-list">
                <h3>Oyuncular:</h3>
                <div id="players-list"></div>
            </div>
            <button id="start-game-btn" class="start-game-btn" disabled>Oyunu Başlat (4 oyuncu gerekli)</button>
        </div>

        <div id="game-section" style="display:none; padding-top:60px;">
            <!-- Top Navbar -->
            <nav class="navbar">
                <div class="nav-left">
                    <button id="dealBtn">Kartları Dağıt</button>
                    <details class="dropdown">
                        <summary>Bot Kontrolleri</summary>
                        <div class="dropdown-menu">
                            <h3>Bot Kontrolleri</h3>
                            <div id="bot-controls" style="margin: 10px 0;">
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button id="bot1-toggle" class="bot-btn" data-player="0">Oyuncu 1: İnsan</button>
                                    <button id="bot2-toggle" class="bot-btn" data-player="1">Oyuncu 2: İnsan</button>
                                    <button id="bot3-toggle" class="bot-btn" data-player="2">Oyuncu 3: İnsan</button>
                                    <button id="bot4-toggle" class="bot-btn" data-player="3">Oyuncu 4: İnsan</button>
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
                <div class="nav-center">Pinaki Online</div>
                <div class="nav-right">
                    <details class="dropdown">
                        <summary>Nasıl Oynanır</summary>
                        <div class="dropdown-menu" style="max-width: 420px;">
                            <h3>Nasıl Oynanır</h3>
                            <ul style="margin:0;padding-left:18px;">
                                <li>4 oyuncu, iki takım (1&3 ve 2&4).</li>
                                <li>Kartlar dağıtılır, ihale sırasıyla yapılır.</li>
                                <li>İhaleyi kazanan oyuncu koz rengini seçer.</li>
                                <li>Sırası gelen oyuncu kurallara uygun kart atar.</li>
                                <li>4 kart atılınca eli en yüksek kart alır ve yeni eli başlatır.</li>
                                <li>Oyun sonu puanlar otomatik hesaplanır.</li>
                            </ul>
                        </div>
                    </details>
                </div>
            </nav>
            <div id="left-panel">
                <div id="auction" style="margin: 15px 0;">
                    <h2>İhale Süreci</h2>
                    <div id="auction-status">Kartlar dağıtıldıktan sonra ihale başlayacak.</div>
                    <div id="auction-controls" style="display:none;">
                        <span id="auction-player"></span>
                        <input type="number" id="bid-input" min="0" placeholder="Teklif (sayı)">
                        <button id="bid-btn">Teklif Ver</button>
                        <button id="pass-btn">Pas</button>
                        <button id="sordum-btn" style="display:none;">Sordum</button>
                        <button id="konus-btn" style="display:none;">Konuş</button>
                        <button id="boz-btn" style="display:none;">Boz</button>
                    </div>
                    <div id="auction-highest-bid" style="margin-top:8px;font-weight:bold;"></div>
                </div>
                <div id="trump-select" style="display:none; margin: 15px 0;">
                    <h2>Koz Seçimi</h2>
                    <div id="trump-player"></div>
                    <button class="trump-btn" data-suit="♥">♥ Kupa</button>
                    <button class="trump-btn" data-suit="♠">♠ Maça</button>
                    <button class="trump-btn" data-suit="♦">♦ Karo</button>
                    <button class="trump-btn" data-suit="♣">♣ Sinek</button>
                </div>
            </div>
            <div id="right-panel">
                <div id="endgame-result" style="margin-top:0px;font-size:14px;font-weight:bold;color:#ffd700;"></div>
            </div>
            <div id="players" style="margin-top:-50px;">
                <div class="player" id="player1"><h4 id="player1-name">Oyuncu 1</h4><div class="cards"></div></div>
                <div class="player" id="player2"><h4 id="player2-name">Oyuncu 2</h4><div class="cards"></div></div>
                <div class="player" id="player3"><h4 id="player3-name">Oyuncu 3</h4><div class="cards"></div></div>
                <div class="player" id="player4"><h4 id="player4-name">Oyuncu 4</h4><div class="cards"></div></div>
                <div id="table-center"><h3>Masa</h3><div id="center-cards"></div></div>
            </div>
            <div id="score-table" style="display:none; position:fixed; left:24px; bottom:20px; max-width:280px; min-width:200px; background:rgba(0,0,0,0.8); color:#fff; font-size:14px; border-radius:6px; padding:8px; z-index:1000; text-align:center; border:1px solid rgba(255,255,255,0.2);"></div>
            <div id="pota-chat" style="position:fixed; right:24px; bottom:24px; width:320px; background:rgba(0,0,0,0.85); color:#fff; border-radius:10px; padding:12px; z-index:1001; font-size:17px; box-shadow:0 2px 12px #0005;">
                <div id="pota-chat-messages" style="max-height:160px; overflow-y:auto; margin-bottom:8px;"></div>
                <div style="display:flex; gap:6px;">
                    <input id="pota-chat-input" type="text" maxlength="40" placeholder="Pota mesajı yaz..." style="flex:1; border-radius:6px; border:none; padding:6px; font-size:16px;">
                    <button id="pota-chat-send" style="border-radius:6px; border:none; background:#ffd700; color:#222; font-weight:bold; padding:6px 12px; cursor:pointer;">Gönder</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="script.js?v=3"></script>
    <script type="module">
        import { 
            startOnlineGame, 
            handleCardPlayed, 
            setupEventListeners,
            connectToServer,
            joinRoom,
            joinAsSpectator,
            startGame
        } from `./online.js?v=15&r=${Math.random()}&t=${Date.now()}&cache=${Math.random()}`;
        
        // Test için fonksiyonları global scope'a ekle (sadece test amaçlı)
        window.startOnlineGame = startOnlineGame;
        window.handleCardPlayed = handleCardPlayed;
        window.setupEventListeners = setupEventListeners;
        
        // Fonksiyonun güncel olup olmadığını test et
        console.log('startOnlineGame fonksiyonu güncel mi:', startOnlineGame.toString().includes('=== startOnlineGame BAŞLADI ==='));
        
        // Event listener'ları kur
        setupEventListeners();
        
        // WebSocket bağlantısını kur (eğer henüz kurulmamışsa)
        if (!window.socket || !window.socket.connected) {
            connectToServer();
        }
        
        console.log('✅ online.js modülü başarıyla yüklendi ve hazır!');
    </script>
    <script src="bot.js?v=3"></script>
</body>
</html> 